<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>demo</title>

    <link rel="stylesheet"
    href="http://kaps.esrichina.com.cn/jsapi/4.18/esri/css/main.css"" />

    <style>
      html,
      body,
      #viewDiv {
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
      }
    </style>
  </head>

  <body>
    <div id="viewDiv"></div>
  </body>

  <script src="http://kaps.esrichina.com.cn/jsapi/4.18/"></script>

  <script>
    require([
      "esri/Basemap",
      "esri/Map",
      "esri/views/MapView",
      "esri/layers/MapImageLayer",
      "esri/layers/WebTileLayer",
      "esri/geometry/Extent",
      "esri/Graphic",
      "esri/geometry/Polygon",
      "esri/widgets/LayerList",
      "esri/request",
      "esri/layers/TileLayer",
      "esri/layers/support/TileInfo",
      "esri/layers/MapServerClipLayer",
      "esri/layers/TileClipLayer",
      "esri/layers/TileClipMapImageLayer",
      "esri/layers/TileClipImageryLayer"
    ], function (
      Basemap,
      Map,
      MapView,
      MapImageLayer,
      WebTileLayer,
      Extent,
      Graphic,
      Polygon,
      LayerList,
      request,
      TileLayer,
      TileInfo,
      MapServerClipLayer,
      TileClipLayer,
      TileClipMapImageLayer,
      TileClipImageryLayer
    ) {
      const _self = this;
      let urlALL =
        "https://kaps.esrichina.com.cn/arcgis/rest/services/zhangm/sheng_shi3857/MapServer";
      // let urlALL='http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer'
      // var layer = new MapImageLayer({
      //   url: urlALL,
      // });
      // const basemap = new Basemap({
      //   baseLayers: [
      //     layer,
      //     //   initTDTLayer(config.TDT.layer.vector.base_map, WebTileLayer),
      //     //   initTDTLayer(config.TDT.layer.vector.base_note, WebTileLayer)
      //   ],
      // });
      let layer = new WebTileLayer({
        title: "底图",
        urlTemplate:
          "http://{subDomain}.tianditu.gov.cn/DataServer?T=vec_w&x={col}&y={row}&l={level}&tk=85bebfb44b48bef32f4c64c204ff2cad",
        subDomains: ["t0", "t1", "t2", "t3", "t4", "t5", "t6", "t7"],
      });
      var map = new Map({
        // basemap: basemap,
        layers: [layer],
      });

      // create a new instance of the view
      var view = new MapView({
        container: "viewDiv",
        map: map,
        center: [110.078002, 34.712836],
        zoom: 5,
      });
      // create a new layer list
      var layerList = new LayerList({
        view: view,
      });

      // var layer = new TileLayer({
      //   url: urlALL,
      // });
      // map.add(layer);
      let url =
        "http://kaps.esrichina.com.cn/arcgis/rest/services/zhangm/DQHX/MapServer";
      var vertices = [
        [11801374.27795279, 5801789.702776402],
        [11243689.719584292, 5097346.050100405],
        [11331745.176168792, 4265711.182357908],
        [12544953.689110786, 4040680.5710864095],
        [12554737.628731288, 4040680.5710864095],
        [12564521.568351787, 4040680.5710864095],
        [12310139.138218788, 4764692.103003407],
      ];
      let tileInfo = new TileInfo({
        dpi: 96,
        format: "png",
        spatialReference: { wkid: 3857 },
        size: [256, 256],
        origin: {
          x: -2.0037508342787e7,
          y: 2.0037508342787e7,
        },
        lods: [
          {
            level: 0,
            resolution: 156543.033928,
            scale: 5.91657527591555e8,
          },
          {
            level: 1,
            resolution: 78271.5169639999,
            scale: 2.95828763795777e8,
          },
          {
            level: 2,
            resolution: 39135.7584820001,
            scale: 1.47914381897889e8,
          },
          {
            level: 3,
            resolution: 19567.8792409999,
            scale: 7.3957190948944e7,
          },
          {
            level: 4,
            resolution: 9783.93962049996,
            scale: 3.6978595474472e7,
          },
          {
            level: 5,
            resolution: 4891.96981024998,
            scale: 1.8489297737236e7,
          },
          {
            level: 6,
            resolution: 2445.98490512499,
            scale: 9244648.868618,
          },
          {
            level: 7,
            resolution: 1222.99245256249,
            scale: 4622324.434309,
          },
          {
            level: 8,
            resolution: 611.49622628138,
            scale: 2311162.217155,
          },
          {
            level: 9,
            resolution: 305.748113140558,
            scale: 1155581.108577,
          },
          {
            level: 10,
            resolution: 152.874056570411,
            scale: 577790.554289,
          },
          {
            level: 11,
            resolution: 76.4370282850732,
            scale: 288895.277144,
          },
          {
            level: 12,
            resolution: 38.2185141425366,
            scale: 144447.638572,
          },
          {
            level: 13,
            resolution: 19.1092570712683,
            scale: 72223.819286,
          },
          {
            level: 14,
            resolution: 9.55462853563415,
            scale: 36111.909643,
          },
          {
            level: 15,
            resolution: 4.77731426794937,
            scale: 18055.954822,
          },
          {
            level: 16,
            resolution: 2.38865713397468,
            scale: 9027.977411,
          },
          {
            level: 17,
            resolution: 1.19432856685505,
            scale: 4513.988705,
          },
          {
            level: 18,
            resolution: 0.597164283559817,
            scale: 2256.994353,
          },
          {
            level: 19,
            resolution: 0.298582141647617,
            scale: 1128.497176,
          },
          {
            level: 20,
            resolution: 0.14929107082380833,
            scale: 564.248588,
          },
          {
            level: 21,
            resolution: 0.07464553541190416,
            scale: 282.124294,
          },
          {
            level: 22,
            resolution: 0.03732276770595208,
            scale: 141.062147,
          },
          {
            level: 23,
            resolution: 0.01866138385297604,
            scale: 70.5310735,
          },
        ],
      });

      var geometry = new Polygon({
        rings: vertices,
        spatialReference: { wkid: 3857 },
      });
      var symbol = {
        type: "simple-fill", // autocasts as SimpleFillSymbol
        color: "rgba(225,25,25,0.2)",
        // style: "solid",
        outline: {
          // autocasts as SimpleLineSymbol
          color: "rgb(25,255,25)",
          width: 1.5,
        },
      };

      var polygonGraphic = new Graphic({
        geometry: geometry,
        symbol: symbol,
      });
      view.graphics.add(polygonGraphic);
      //自定义范围 动态图层 
      var ImageOverlayLayer = new MapServerClipLayer({
        id: "RasterLayer",
        title: "地图服务(非动态切片)",
        url:  "https://kaps.esrichina.com.cn/arcgis/rest/services/zhangm/sheng_shi3857/MapServer", 
        geometry: geometry,
        layerid: "0,1",
        view: view,
      });
      //自定义范围 切片图层 
      var street = new TileClipLayer({
        id: "street",
        title: "天地图",
        // url:
        //   "http://map.geoq.cn/ArcGIS/rest/services/ChinaOnlineCommunity/MapServer/tile/{z}/{y}/{x}?blankTile=false",
        url:
          "http://t0.tianditu.gov.cn/DataServer?T=vec_w&x={x}&y={y}&l={z}&tk=85bebfb44b48bef32f4c64c204ff2cad",
        geometry: geometry,
        view: view,
      });
      var label = new TileClipLayer({
        id: "label",
        title: "标注",
        url:
          "http://t0.tianditu.gov.cn/DataServer?T=cva_w&x={x}&y={y}&l={z}&tk=85bebfb44b48bef32f4c64c204ff2cad",
        geometry: geometry,
        view: view,
      });
      //自定义范围 动态切片动态图层 
      var tileMapImageLayer = new TileClipMapImageLayer({
        id: "tileMapImageLayer",
        title: "动态切片地图服务",
        url:  "https://kaps.esrichina.com.cn/arcgis/rest/services/zhangm/sheng_shi3857/MapServer",
        sublayers: [
          {
            id: 0,
            visible: true,
          },
        ],
        geometry: geometry,
        view: view,
      });
      //自定义范围 动态切片影像图层 

      var tileImageLayer = new TileClipImageryLayer({
        id: "tileImageLayer",
        title: "动态切片影像",
        url: 'https://kaps.esrichina.com.cn/arcgis/rest/services/ftkx/cly020_1k_md/ImageServer',
        geometry: geometry,
        view: view,
      });


      map.add(ImageOverlayLayer);
      map.add(street);
      map.add(label);
      map.add(tileMapImageLayer);
      map.add(tileImageLayer);


      view.ui.add(layerList, "top-right");
    });
  </script>
</html>
